const products = [

    {
        "name": "Snikers #1",
        "price": 103.50,
        "data": 1,
        "sex": "women",
        "data-check": 1,
        "image": "bg-01.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."
    },
    {
        "name": "Snikers #2",
        "price": 152.14,
        "data": 2,
        "sex": "men",
        "data-check": 2,
        "image": "bg-02.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."
    },
    {
        "name": "Snikers #3",
        "price": 202.22,
        "data": 3,
        "sex": "women",
        "data-check": 3,
        "image": "bg-03.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."
    },
    {
        "name": "Snikers #4",
        "price": 240.00,
        "data": 4,
        "sex": "women",
        "data-check": 4,
        "image": "bg-04.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."
    },
    {
        "name": "Snikers #5",
        "price": 180.30,
        "data": 5,
        "sex": "women",
        "data-check": 5,
        "image": "bg-05.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },
    {
        "name": "Snikers #6",
        "price": 186.50,
        "data": 6,
        "sex": "children",
        "data-check": 6,
        "image": "bg-06.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },

    {
        "name": "Snikers #7",
        "price": 111.60,
        "data": 7,
        "sex": "men",
        "data-check": 7,
        "image": "bg-07.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },
    {
        "name": "Snikers #8",
        "price": 169.64,
        "data": 8,
        "sex": "women",
        "data-check": 8,
        "image": "bg-08.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },
    {
        "name": "LeBron 16 #9",
        "price": 215.20,
        "data": 9,
        "sex": "women",
        "data-check": 9,
        "image": "bg-09.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },
    {
        "name": "Nike Zoom KD11 #10",
        "price": 245.00,
        "data": 10,
        "sex": "men",
        "data-check": 10,
        "image": "bg-10.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },
    {
        "name": "Snikers #11",
        "price": 109.30,
        "data": 11,
        "sex": "children",
        "data-check": 11,
        "image": "bg-05.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },
    {
        "name": "Snikers #12",
        "price": 198.50,
        "data": 12,
        "sex": "women",
        "data-check": 12,
        "image": "bg-06.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },

    {
        "name": "Snikers #13",
        "price": 128.69,
        "data": 13,
        "sex": "women",
        "data-check": 13,
        "image": "bg-01.jpg",
        "description": "These are very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },
    {
        "name": "Snikers #14",
        "price": 179.00,
        "data": 14,
        "sex": "men",
        "data-check": 14,
        "image": "bg-02.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },
    {
        "name": "Snikers #15",
        "price": 260.20,
        "data": 15,
        "sex": "children",
        "data-check": 15,
        "image": "bg-03.jpg",
        "description": "This is very cool snikers. Nice beautiful and quality",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },

    {
        "name": "Snikers #16",
        "price": 301.20,
        "data": 16,
        "sex": "men",
        "data-check": 16,
        "image": "bg-03.jpg",
        "description": "This is very cool snikers. Nice colorfull and quality good",
        "more_description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam architecto dolor eaque magnam ut! Nam, temporibus vitae! Aspernatur dolores excepturi maiores neque numquam quasi voluptatibus."

    },

];


let per_page = 6;
let current = 0;

let pagination = document.getElementById("pagination");
let s = document.getElementById("search");
const search_button = document.getElementById("search_button");
let countText = document.getElementById("count");
let add_items = document.getElementById("add_items");


countText.innerHTML = "quantity in this store: " + products.length;



function searchProd(){
//// Search
    search_button.addEventListener("click", (e) => {
        // console.log("khjghj");
        search()
    });

    s.addEventListener("keypress", (e) => {
        if (e.keyCode == 13) {
            // console.log("jakjc");
            search();
        };
    });

    function search() {
        let filter_prod;
        current = 0;
        let s_filter = new RegExp(s.value);
        filter_prod = products.filter((el) => s_filter.test(el.name) || s_filter.test(el.description));

        countText.innerHTML = "your choose compose from:   " + filter_prod.length + "  items";

        pagination.innerHTML = ""
        createCatalog(filter_prod);
    }
}


// CREATE NEW ELEMENT
function createNewElement(tag, innerContent = null, classStr = null, attr = null) {
    var el = document.createElement(tag);
    el.innerHTML = (innerContent) ? innerContent : "";
    el.className = (classStr) ? classStr : "";

    if (attr) {
        attr.map((attr_rl) => el.setAttribute(attr_rl.name, attr_rl.value));
    }

    return el;
}


//CREATE CARD
function createCard(product) {

    var link = createNewElement("a", "Add to cart", "btn btn-primary add_card", [{"name": "href", "value": "#"}]);
    link.setAttribute("name", product.data);


    var p = createNewElement("p", product.description, "card-text");
    var title = createNewElement("h5", product.name, "card-title");
    var coast = createNewElement("h3", "$ " + product.price, "");


    var cardBody = attachChilderToParent(createNewElement("div", null, "card-body"), [title, p, coast, link]);

    // cardBody.appendChild(link)


    var image = createNewElement("img", null, "card-img-top", [{
        "name": "src",
        "value": "images/" + product.image
    }, {"name": "alt", "value": product.name}]);

    var card = attachChilderToParent(createNewElement("div", null, "card"), [image, cardBody]);

    var catalogItem = attachChilderToParent(createNewElement("div", null, "col-lg-3 col-md-6 mb-2 catalog-item"), [card]);

    return catalogItem;
};


//CREATE PARRENTS
function attachChilderToParent(html, array_el) {
    array_el.map((el) => html.appendChild(el));
    return html;
};


//// RENDER CATALOG
////////////////////////////////////////////////
function first_prod() {
    return current * per_page;
}

function last_prod(i, array_products) {
    return i < current * per_page + per_page && i < array_products.length //// > ошибка: вместо array_products было products
}

let catalog = document.getElementById("catalog");

function createCatalog(array_products) {
    catalog.innerHTML = "";
    for (let i = first_prod(); last_prod(i, array_products); i++) {
        catalog.appendChild(createCard(array_products[i]));
    }
    // clickMore();
    CreatePouPap()
    createPag(array_products)
}

////////////////////////////////////////////////


//// Pagination
function createPag(array_products) {
    let li, activeEl, ul;

    pagination.innerHTML = ""; // add

    ul = createNewElement("ul", null, "pagination")
    for (let i = 0; i < Math.ceil(array_products.length / per_page); i++) {
        let link = createNewElement("a", i + 1, "page-link", [{"name": "href", "value": "#"}]);

        activeEl = (i == current) ? "page-item active" : "page-item";
        li = attachChilderToParent(createNewElement("li", null, activeEl, [{"name": "id", "value": i}]), [link]);

        ul.appendChild(li)
    }
    pagination.appendChild(ul);

    Array.from(document.getElementsByClassName("page-item")).map((el) => {
        el.addEventListener("click", (e) => {
            // e.target;
            // console.log(el.id);
            current = el.id;
            console.log(current);
            products.innerHTML = "";
            createCatalog(array_products)
        })
    })
    // pag(array_products); //// МОЖНО БЕЗ НЕЕ!! > она выше!
}

//// МОЖНО БЕЗ НЕЕ!!
// function pag(array_products){
//     Array.from(document.getElementsByClassName("page-item")).map((el)=>{
//         el.addEventListener("click",(e)=>{
//             e.target;
//             // console.log(el.id);
//             current = el.id;
//             // console.log(current);
//             products.innerHTML = "";
//             createCatalog(array_products)
//         })
//     })
// }


// CREATE POU PAP
function CreatePouPap() {
    let buttonClass = document.getElementsByClassName("add_card");


    let button;
    let coastP;
    let boxDesc;
    let rowSecond;
    let buyBox;
    let imgP;
    let name;
    let buttonExit;
    let buttonExitIcon;
    let frontPage;
    let colLeft, colRight;
    let firstRow;
    let blockDescription;
    let mainBlockDescription = document.getElementById("main_box_pou_pup");
    let buttonExitIconGet

    Array.from(buttonClass).map((el) => {
        el.addEventListener("click", (e) => {
            for (let i = 0; i < products.length; i++) {
                if (el.name == products[i].data) {

                    name = createNewElement("h5", products[i].name, "nameSnickers");
                    button = createNewElement("button", "Add to cart", "buy btn btn-primary");
                    coastP = createNewElement("h5", "Coast: " + products[i].price + " $", "coast", [{
                        "name": "href",
                        "value": "#"
                    }]);
                    buyBox = attachChilderToParent(createNewElement("div", null, "buyBox col-xs-4 col-md-12 col-sm-12"), [button, coastP]);

                    boxDesc = createNewElement("div", products[i].more_description, "description col-xs-8 col-md-12 col-sm-12");

                    rowSecond = attachChilderToParent(createNewElement("div", null, "row"), [boxDesc, buyBox]);

                    imgP = createNewElement("img", "", "img_snickers", [{
                        "name": "src",
                        "value": "images/" + products[i].image
                    }]);

                    buttonExitIcon = createNewElement("i", "", "fas fa-plus");
                    buttonExit = attachChilderToParent(createNewElement("div", null, "exit", [{
                        "name": "id",
                        "value": "exitBox"
                    }]), [buttonExitIcon]);

                    colLeft = createNewElement("div", "", "col-xs-3 col-md-3 col-sm-3");

                    colRight = createNewElement("div", "", "col-xs-3 col-md-3 col-sm-3");

                    frontPage = attachChilderToParent(createNewElement("div", null, "front col-xs-6 col-md-6 col-sm-6"), [buttonExit, imgP, name, rowSecond]);

                    firstRow = attachChilderToParent(createNewElement("div", null, "row"), [colLeft, frontPage, colRight]);


                    blockDescription = attachChilderToParent(createNewElement("div", null, "block_description col-xs-12 col-md-12 col-sm-12"), [firstRow]);

                    mainBlockDescription.appendChild(blockDescription)


                    buttonExitIconGet = document.getElementById("exitBox");
                    buttonExitIconGet.addEventListener("click", (e) => {
                        mainBlockDescription.innerHTML = "";
                        console.log("close");
                    });
                }
                ;

                document.body.addEventListener("keydown", (e) => {
                    if (e.keyCode == 27) {
                        mainBlockDescription.innerHTML = "";
                    }
                    ;
                });
            }
            ;
        });
    });
}


//// FOR POU-PAP //// не работает
function clickMore() {
    Array.from(document.getElementsByClassName("add_card")).map((el) => {
        el.addEventListener("click", (e) => {
            console.log(el.name);
            for (let i = 0; i < products.length; i++) {
                if (products[i].data == el.name) {
                    console.log("this el: " + el.name);
                    console.log(e.target);
                }
            }
        })
    })
}


//// ADD TO CATALOG
function valid() {

    let name = document.getElementById("name");
    let price = document.getElementById("price");
    let description = document.getElementById("description");
    let gander = document.getElementById("gander");
    let img = document.getElementById("img");


    let prodModel = {
        "name": name.value,
        "price": price.value,
        "data": 1,
        "sex": gander.value,
        "data-check": 88,
        "image": img.value,
        "description": description.value,
        "more_description":  description.value
    };
    // console.log(addProd);
    products.push(prodModel)
    alert("Item was add in catalog!");
    document.getElementById("addItem_box").style.height = "0px";
}
function showProdAddBox() {
    add_items.addEventListener("click", (e) => {
        let x = document.getElementById("addItem_box");
        x.style.height = "420px";
        console.log(x);
    });
    document.body.addEventListener("keydown", (e) => {
        let x = document.getElementById("addItem_box");
        if (e.keyCode == 27) {
            x.style.height = "0px";
        };
    });
}





showProdAddBox();
searchProd();

createCatalog(products)

